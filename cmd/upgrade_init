#!/bin/bash

### This script is called before the user upgrades the application.
### 升级前准备：备份用户配置数据

LOG_FILE="${TRIM_PKGVAR}/info.log"

log_msg() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - [upgrade_init] $1" >> ${LOG_FILE}
}

log_msg "Upgrade init started"

# 备份当前 settings.json（防止升级过程中丢失用户配置）
if [ -f "${TRIM_PKGVAR}/settings.json" ]; then
    cp "${TRIM_PKGVAR}/settings.json" "${TRIM_PKGVAR}/settings.json.bak"
    log_msg "Settings backed up"
fi

log_msg "Upgrade init completed"
exit 0
